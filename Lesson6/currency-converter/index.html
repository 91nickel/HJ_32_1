<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Конвертер валют</title>
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.12/css/all.css"
    integrity="sha384-G0fIWCsCzJIMAVNQPfjH08cyYaUtMwjJwqiRKxxE/rx96Uroj1BtIQ6MLJuheaO9" crossorigin="anonymous">
  <link rel="stylesheet" href="css/style.css">
</head>

<body>
  <main id="content" class="hidden">
    <input type="number" id="source" value="100">
    <select id="from"></select>
    <span><i class="fa fa-angle-double-right" aria-hidden="true"></i></span>
    <select id="to"></select>
    <output id="result"></output>
  </main>
  <div id="loader" class="hidden">Загрузка...</div>

  <script>
    document.getElementById('loader').classList.toggle('hidden');
    var result;
    const request = new XMLHttpRequest();
    request.addEventListener('load', () => {
      document.getElementById('loader').classList.toggle('hidden');
      result = JSON.parse(request.responseText);
      console.log(result);
      let from = document.getElementById('from').innerHTML = new Array(result.length).fill(1).map((el, i) => {
        return '<option data-value="' + result[i].value + '" data-code="' + result[i].code + '">' + result[i]
          .title + '</option>';
      }).join('');
      document.getElementById('to').innerHTML = new Array(result.length).fill(1).map((el, i) => {
        return '<option data-value="' + result[i].value + '" data-code="' + result[i].code + '">' + result[i]
          .title + '</option>';
      }).join('');
      getOutput();
      document.getElementById('content').classList.remove('hidden');
      document.querySelector('input').addEventListener('input', getOutput);
      document.querySelectorAll('select').forEach((el)=>{el.addEventListener('input', getOutput);});
    });
    request.addEventListener('load', () => {});
    request.open('GET', 'https://neto-api.herokuapp.com/currency');
    request.send();

    function getOutput() {
      let count = document.getElementById('source').value;
      let from = result.find((el) => {
        if (el.title === document.querySelector('#from').value) {
          return el;
        }
      }).value;
      let to = result.find((el) => {
        if (el.title === document.querySelector('#to').value) {
          return el;
        }
      }).value;

      document.getElementById('result').innerHTML = Math.round(count * from / to * 100) / 100;

      console.log(count);
      console.log(from);
      console.log(to);
    }
  </script>


</body>

</html>